### Port conventions (though there are many, many exceptions)
# 81xx - grapl services (and some `wait-for-it` http servers)
# 82xx - TBD
# 83xx - grapl plugin services, like grapl-aws-plugins
# 84xx - debugger ports (see vsc_debugger.py)

version: "3.8"
volumes:
  dgraph_export:

x-common-variables:
  aws-region: &aws-region
    AWS_REGION: "us-east-1"
    AWS_DEFAULT_REGION: "us-east-1"  # boto3 prefers this one
  sqs-endpoint: &sqs-endpoint
    SQS_ENDPOINT: "http://sqs.us-east-1.amazonaws.com:9324"
    SQS_ACCESS_KEY_ID: "dummy_cred_aws_access_key_id"
    SQS_ACCESS_KEY_SECRET: "dummy_cred_aws_secret_access_key"
  s3-endpoint: &s3-endpoint
    S3_ENDPOINT: "http://s3:9000"
    S3_ACCESS_KEY_ID: "minioadmin"
    S3_ACCESS_KEY_SECRET: "minioadmin"
  dynamodb-endpoint: &dynamodb-endpoint
    DYNAMODB_ENDPOINT: "http://dynamodb:8000"
    DYNAMODB_ACCESS_KEY_ID: "dummy_cred_aws_access_key_id"
    DYNAMODB_ACCESS_KEY_SECRET: "dummy_cred_aws_secret_access_key"
  dynamodb-mapping-tables: &dynamodb-mapping-tables
    STATIC_MAPPING_TABLE: local-grapl-static_mapping_table
    DYNAMIC_SESSION_TABLE: local-grapl-dynamic_session_table
    PROCESS_HISTORY_TABLE: local-grapl-process_history_table
    FILE_HISTORY_TABLE: local-grapl-file_history_table
    INBOUND_CONNECTION_HISTORY_TABLE: local-grapl-inbound_connection_history_table
    OUTBOUND_CONNECTION_HISTORY_TABLE: local-grapl-outbound_connection_history_table
    NETWORK_CONNECTION_HISTORY_TABLE: local-grapl-network_connection_history_table
    IP_CONNECTION_HISTORY_TABLE: local-grapl-ip_connection_history_table
    ASSET_ID_MAPPINGS: local-grapl-asset_id_mappings
  mg-alphas: &mg-alphas
    MG_ALPHAS: "master_graph:9080"
  log-level: &log-level
    RUST_LOG: "${RUST_LOG:-ERROR}"
    GRAPL_LOG_LEVEL: "${GRAPL_LOG_LEVEL:-ERROR}"

services:

  #
  # Infrastructure dependencies
  #

  grapl-master-graph-db:
    tty: false
    image: dgraph/standalone:v20.07.1
    ports:
      - "5080:5080"  # zero - used for `dgraph live` importing-data command in `integration_tests.rst`
      - "8000:8000"  # ratel
      - "8080:8080"  # alpha http
      - "9080:9080"  # alpha grpc
    logging:
      driver: none
    volumes:
      - type: volume
        source: dgraph_export
        # Hitting :8080/admin/export will force an export to be written to this directory.
        target: /dgraph/export

  # dev uses 1 big redis instance, prod has 1:1 redis per grapl service
  dev-shared-redis:  # maybe transitory, this will eventually match prod
    image: redis:latest
    command: |
      sh -c "
        # hack from https://stackoverflow.com/questions/54533308/disable-redis-persistence-in-docker
        # to disable persistence
        rm -f /data/dump.rdb && redis-server
      "
    ports:
      - "6379:6379" # redis default
    logging:
      driver: none

  sqs:
    image: localstack/localstack:0.11.5
    environment:
      - SERVICES=sqs:9324
      - HOSTNAME_EXTERNAL=sqs.us-east-1.amazonaws.com
      - IMAGE_NAME=localstack/localstack:0.11.5
    ports:
      - "9324:9324"
    networks:
      default:
        aliases:
          - sqs.us-east-1.amazonaws.com
    logging:
      driver: none

  secretsmanager:
    image: localstack/localstack:0.11.5
    environment:
      - PORT_WEB_UI=8099
      - SERVICES=secretsmanager:4584
      - HOSTNAME_EXTERNAL=secretsmanager.us-east-1.amazonaws.com
      - IMAGE_NAME=localstack/localstack:0.11.5

    ports:
      - "4584:4584"
      - "8099:8099"
    # logging:
    #   driver: none

  s3:
    image: minio/minio
    command: server /data
    environment:
      - MINIO_ACCESS_KEY=minioadmin
      - MINIO_SECRET_KEY=minioadmin
      - MINIO_REGION_NAME=us-east-1
    ports:
      - "9000:9000"
    networks:
      default:
        aliases:
          - minio
    logging:
      driver: none

  dynamodb:
    image: amazon/dynamodb-local
    environment:
      - AWS_REGION="us-east-1"
      - REGION="us-east-1"
    logging:
      driver: none

  #
  # Rust services
  #

  grapl-metric-forwarder:
    image: grapl/grapl-metric-forwarder:${TAG:-latest}
    build:
      context: src/rust
      target: metric-forwarder-deploy
      args:
        - CARGO_PROFILE=${CARGO_PROFILE:-debug}
    tty: false
    environment:
      IS_LOCAL: "True"
      <<: *log-level
    extra_hosts:
      - amazonaws:127.0.0.1

  grapl-sysmon-subgraph-generator:
    image: grapl/grapl-sysmon-subgraph-generator:${TAG:-latest}
    build:
      context: src/rust
      target: sysmon-subgraph-generator-deploy
      args:
        - CARGO_PROFILE=${CARGO_PROFILE:-debug}
    tty: false
    environment:
      <<: *log-level
      EVENT_CACHE_CLUSTER_ADDRESS: "dev-shared-redis:6379"
      IS_LOCAL: "True"
      SOURCE_QUEUE_URL: "http://sqs.us-east-1.amazonaws.com:9324/000000000000/grapl-sysmon-graph-generator-queue"
      RETRY_QUEUE_URL: "http://sqs.us-east-1.amazonaws.com:9324/000000000000/grapl-sysmon-graph-generator-retry-queue"
      DEAD_LETTER_QUEUE_URL: "http://sqs.us-east-1.amazonaws.com:9324/queue/grapl-sysmon-graph-generator-dead-letter-queue"
      DEST_QUEUE_URL: "http://sqs.us-east-1.amazonaws.com:9324/queue/grapl-node-identifier-queue"
      DEST_BUCKET_NAME: "local-grapl-unid-subgraphs-generated-bucket"
      <<: *sqs-endpoint
      <<: *s3-endpoint
    links:
      - s3:minio
      - sqs:sqs.us-east-1.amazonaws.com
    extra_hosts:
      - sqs:127.0.0.1
      - amazonaws:127.0.0.1
      - minio:127.0.0.1
    depends_on:
      - s3
      - sqs
      - grapl-provision

  grapl-osquery-subgraph-generator:
    image: grapl/grapl-osquery-subgraph-generator:${TAG:-latest}
    build:
      context: src/rust
      target: osquery-subgraph-generator-deploy
      args:
        - CARGO_PROFILE=${CARGO_PROFILE:-debug}
    tty: false
    environment:
      <<: *log-level
      BUCKET_PREFIX: "local-grapl"
      IS_LOCAL: "True"
      SOURCE_QUEUE_URL: "http://sqs.us-east-1.amazonaws.com:9324/queue/grapl-osquery-graph-generator-queue"
      RETRY_QUEUE_URL: "http://sqs.us-east-1.amazonaws.com:9324/queue/grapl-osquery-graph-generator-retry-queue"
      DEAD_LETTER_QUEUE_URL: "http://sqs.us-east-1.amazonaws.com:9324/queue/grapl-osquery-graph-generator-dead-letter-queue"
      EVENT_CACHE_CLUSTER_ADDRESS: "dev-shared-redis:6379"
      DEST_QUEUE_URL: "http://sqs.us-east-1.amazonaws.com:9324/queue/grapl-node-identifier-queue"
      DEST_BUCKET_NAME: "local-grapl-unid-subgraphs-generated-bucket"
      <<: *sqs-endpoint
      <<: *s3-endpoint
    links:
      - s3:minio
      - sqs:sqs.us-east-1.amazonaws.com
    extra_hosts:
      - sqs:127.0.0.1
      - amazonaws:127.0.0.1
      - minio:127.0.0.1
    depends_on:
      - s3
      - sqs
      - grapl-provision

  grapl-node-identifier:
    image: grapl/grapl-node-identifier:${TAG:-latest}
    build:
      context: src/rust
      target: node-identifier-deploy
      args:
        - CARGO_PROFILE=${CARGO_PROFILE:-debug}
    environment:
      <<: *log-level
      EVENT_CACHE_CLUSTER_ADDRESS: "dev-shared-redis:6379"
      IS_LOCAL: "true"
      SOURCE_QUEUE_URL: "http://sqs.us-east-1.amazonaws.com:9324/queue/grapl-node-identifier-queue"
      RETRY_QUEUE_URL: "http://sqs.us-east-1.amazonaws.com:9324/queue/grapl-node-identifier-retry-queue"
      DEAD_LETTER_QUEUE_URL: "http://sqs.us-east-1.amazonaws.com:9324/queue/grapl-node-identifier-dead-letter-queue"
      DEST_QUEUE_URL: "http://sqs.us-east-1.amazonaws.com:9324/queue/grapl-graph-merger-queue"
      DEST_BUCKET_NAME: "local-grapl-subgraphs-generated-bucket"
      <<: *sqs-endpoint
      <<: *s3-endpoint
      <<: *dynamodb-endpoint
      <<: *dynamodb-mapping-tables
    tty: false
    links:
      - s3:minio
      - dynamodb:dynamodb
      - sqs:sqs.us-east-1.amazonaws.com
    extra_hosts:
      - sqs:127.0.0.1
      - amazonaws:127.0.0.1
      - minio:127.0.0.1
    depends_on:
      - s3
      - dynamodb
      - sqs
      - grapl-provision

  grapl-node-identifier-retry-handler:
    image: grapl/grapl-node-identifier-retry-handler:${TAG:-latest}
    build:
      context: src/rust
      target: node-identifier-retry-handler-deploy
      args:
        - CARGO_PROFILE=${CARGO_PROFILE:-debug}
    environment:
      <<: *log-level
      IS_LOCAL: "True"
      EVENT_CACHE_CLUSTER_ADDRESS: "dev-shared-redis:6379"
      SOURCE_QUEUE_URL: "http://sqs.us-east-1.amazonaws.com:9324/queue/grapl-node-identifier-retry-queue"
      RETRY_QUEUE_URL: "http://sqs.us-east-1.amazonaws.com:9324/queue/grapl-node-identifier-dead-letter-queue"
      DEAD_LETTER_QUEUE_URL: "http://sqs.us-east-1.amazonaws.com:9324/queue/grapl-node-identifier-dead-letter-queue"
      DEST_QUEUE_URL: "http://sqs.us-east-1.amazonaws.com:9324/queue/grapl-graph-merger-queue"
      DEST_BUCKET_NAME: "local-grapl-subgraphs-generated-bucket"
      <<: *sqs-endpoint
      <<: *s3-endpoint
      <<: *dynamodb-endpoint
      <<: *dynamodb-mapping-tables
    tty: false
    links:
      - s3:minio
      - dynamodb:dynamodb
      - sqs:sqs.us-east-1.amazonaws.com
    extra_hosts:
      - sqs:127.0.0.1
      - amazonaws:127.0.0.1
      - minio:127.0.0.1
    depends_on:
      - s3
      - dynamodb
      - sqs
      - grapl-provision

  grapl-graph-merger:
    image: grapl/grapl-graph-merger:${TAG:-latest}
    build:
      context: src/rust
      target: graph-merger-deploy
      args:
        - CARGO_PROFILE=${CARGO_PROFILE:-debug}
    environment:
      <<: *log-level
      EVENT_CACHE_CLUSTER_ADDRESS: "dev-shared-redis:6379"
      SOURCE_QUEUE_URL: "http://sqs.us-east-1.amazonaws.com:9324/queue/grapl-graph-merger-queue"
      RETRY_QUEUE_URL: "http://sqs.us-east-1.amazonaws.com:9324/queue/grapl-graph-merger-retry-queue"
      DEAD_LETTER_QUEUE_URL: "http://sqs.us-east-1.amazonaws.com:9324/queue/grapl-graph-merger-dead-letter-queue"
      DEST_QUEUE_URL: "http://sqs.us-east-1.amazonaws.com:9324/queue/grapl-analyzer-dispatcher-queue"
      DEST_BUCKET_NAME: "local-grapl-subgraphs-merged-bucket"
      <<: *sqs-endpoint
      <<: *s3-endpoint
      <<: *dynamodb-endpoint
      <<: *mg-alphas
      GRAPL_SCHEMA_TABLE: "local-grapl-grapl_schema_table"
      IS_LOCAL: "True"
    tty: false
    links:
      - s3:minio
      - sqs:sqs.us-east-1.amazonaws.com
      - grapl-master-graph-db:master_graph
    extra_hosts:
      - sqs:127.0.0.1
      - amazonaws:127.0.0.1
      - minio:127.0.0.1
    depends_on:
      - s3
      - sqs
      - grapl-provision
      - grapl-master-graph-db

  grapl-analyzer-dispatcher:
    image: grapl/grapl-analyzer-dispatcher:${TAG:-latest}
    build:
      context: src/rust
      target: analyzer-dispatcher-deploy
      args:
        - CARGO_PROFILE=${CARGO_PROFILE:-debug}
    environment:
      ANALYZERS_BUCKET: "local-grapl-analyzers-bucket"
      SOURCE_QUEUE_URL: "http://sqs.us-east-1.amazonaws.com:9324/queue/grapl-analyzer-dispatcher-queue"
      RETRY_QUEUE_URL: "http://sqs.us-east-1.amazonaws.com:9324/queue/grapl-analyzer-dispatcher-retry-queue"
      DEAD_LETTER_QUEUE_URL: "http://sqs.us-east-1.amazonaws.com:9324/queue/grapl-analyzer-dispatcher-dead-letter-queue"
      DEST_QUEUE_URL: "http://sqs.us-east-1.amazonaws.com:9324/queue/grapl-analyzer-executor-queue"
      DEST_BUCKET_NAME: "local-grapl-analyzer-dispatched-bucket"
      ANALYZER_BUCKET: "local-grapl-analyzers-bucket"
      <<: *aws-region
      <<: *sqs-endpoint
      <<: *s3-endpoint
      <<: *dynamodb-endpoint
      <<: *log-level
      IS_LOCAL: "true"
    tty: false
    links:
      - s3:minio
      - sqs:sqs.us-east-1.amazonaws.com
    extra_hosts:
      - sqs:127.0.0.1
      - amazonaws:127.0.0.1
      - minio:127.0.0.1
    depends_on:
      - s3
      - sqs

  #
  # Python services
  #

  # Removed per https://grapl-internal.slack.com/archives/C017PLQ8TCZ/p1601574470186700
  # Add it back once Analyzer Deployer is ready for prime time!
  # analyzer-deployer:
  #   image: grapl/analyzer-deployer:${TAG:-latest}
  #   command: /bin/sh -c '. venv/bin/activate && cd /home/grapl/app && chalice local --no-autoreload --host=0.0.0.0 --port=8125'
  #   environment:
  #     - "IS_LOCAL=True"
  #     - GRPC_ENABLE_FORK_SUPPORT=1
  #     - "BUCKET_PREFIX=local-grapl"
  #     - GRAPL_LOG_LEVEL=${GRAPL_LOG_LEVEL:-ERROR}
  #   links:
  #     - s3:minio
  #     - sqs:sqs.us-east-1.amazonaws.com
  #   tty: true
  #   extra_hosts:
  #     - sqs:127.0.0.1
  #     - amazonaws:127.0.0.1
  #     - minio:127.0.0.1

  grapl-analyzer-executor:
    image: grapl/grapl-analyzer-executor:${TAG:-latest}
    build:
      context: src
      dockerfile: ./python/Dockerfile
      target: analyzer-executor-deploy
    command: /bin/sh -c '. venv/bin/activate && python3 analyzer_executor/src/run_local.py'
    environment:
      <<: *log-level
      DEBUG_SERVICES: "${DEBUG_SERVICES}"
      HITCACHE_ADDR: "dev-shared-redis"
      HITCACHE_PORT: "6379"
      MESSAGECACHE_ADDR: "dev-shared-redis"
      MESSAGECACHE_PORT: "6379"
      IS_LOCAL: "True"
      GRPC_ENABLE_FORK_SUPPORT: "1"
      <<: *mg-alphas
      IS_RETRY: "False"
      <<: *aws-region
      <<: *sqs-endpoint
      <<: *s3-endpoint
      BUCKET_PREFIX: "local-grapl"
      SOURCE_QUEUE_URL: "http://sqs.us-east-1.amazonaws.com:9324/queue/grapl-analyzer-executor-queue"
      RETRY_QUEUE_URL: "http://sqs.us-east-1.amazonaws.com:9324/queue/grapl-analyzer-executor-retry-queue"
    links:
      - s3:minio
      - sqs:sqs.us-east-1.amazonaws.com
      - grapl-master-graph-db:master_graph
    tty: true
    extra_hosts:
      - sqs:127.0.0.1
      - amazonaws:127.0.0.1
      - minio:127.0.0.1
    ports:
      - 8401:8401  # VSC Debugger

  grapl-ux-router:
    image: grapl/grapl-ux-router:${TAG:-latest}
    build:
      context: src
      dockerfile: ./python/Dockerfile
      target: grapl-ux-router-deploy
    command: |
      /bin/sh -c '
        wait-for-it grapl-engagement-view-uploader:8127 --timeout=180 &&
        . venv/bin/activate &&
        cd app &&
        chalice local --no-autoreload --host=0.0.0.0 --port=8901
      '
    ports:
      - "8901:8901"
    environment:
      IS_LOCAL: "True"
      GRAPL_LOG_LEVEL: "DEBUG"
      UX_BUCKET_NAME: "local-grapl-engagement-ux-bucket"
    depends_on:
      - grapl-engagement-view-uploader
    tty: true
    links:
      - s3:minio
    extra_hosts:
      - minio:127.0.0.1
    networks:
      default:
        aliases:
          - ux_router

  grapl-engagement-creator:
    image: grapl/grapl-engagement-creator:${TAG:-latest}
    build:
      context: src
      dockerfile: ./python/Dockerfile
      target: engagement-creator-deploy
    command: /bin/sh -c '. venv/bin/activate && python3 engagement-creator/src/engagement-creator.py'
    environment:
      IS_LOCAL: "True"
      BUCKET_PREFIX: "local-grapl"
      <<: *log-level
      <<: *mg-alphas
    tty: true
    links:
      - s3:minio
      - sqs:sqs.us-east-1.amazonaws.com
      - grapl-master-graph-db:master_graph
    extra_hosts:
      - sqs:127.0.0.1
      - amazonaws:127.0.0.1
      - minio:127.0.0.1

  grapl-engagement-edge:
    image: grapl/grapl-engagement-edge:${TAG:-latest}
    build:
      context: src
      dockerfile: ./python/Dockerfile
      target: engagement-edge-deploy
    command: |
      /bin/sh -c '
        wait-for-it grapl-provision:8126 --timeout=120 &&
        . venv/bin/activate &&
        cd /home/grapl/app &&
        chalice local --no-autoreload --host=0.0.0.0 --port=8900
      '
    ports:
      - "8900:8900"

    networks:
      default:
        aliases:
          - grapl_auth
    environment:
      IS_LOCAL: "True"
      <<: *log-level
      UX_BUCKET_URL: "localhost:3000"
      USER_AUTH_TABLE: "local-grapl-user_auth_table"
      BUCKET_PREFIX: "local-grapl"
    depends_on:
      - grapl-provision
    tty: true
    links:
      - grapl-master-graph-db:master_graph
      - secretsmanager:secretsmanager.us-east-1.amazonaws.com

  grapl-model-plugin-deployer:
    image: grapl/grapl-model-plugin-deployer:${TAG:-latest}
    build:
      context: src
      dockerfile: ./python/Dockerfile
      target: model-plugin-deployer-deploy
    command: /bin/sh -c '. venv/bin/activate && cd /home/grapl/app && chalice local --no-autoreload --host=0.0.0.0 --port=8123'
    ports:
      - "8123:8123"
    environment:
      IS_LOCAL: "True"
      <<: *mg-alphas
      <<: *log-level
      UX_BUCKET_URL: "localhost"
    tty: true
    links:
      - s3:minio
      - sqs:sqs.us-east-1.amazonaws.com
      - secretsmanager:secretsmanager.us-east-1.amazonaws.com
      - grapl-master-graph-db:master_graph
    extra_hosts:
      - sqs:127.0.0.1
      - amazonaws:127.0.0.1
      - minio:127.0.0.1

  grapl-dgraph-ttl:
    image: grapl/grapl-dgraph-ttl:${TAG:-latest}
    build:
      context: src
      dockerfile: ./python/Dockerfile
      target: dgraph-ttl-deploy
    command: /bin/sh -c '. venv/bin/activate && cd /home/grapl/app && chalice local --no-autoreload --host=0.0.0.0 --port=8124'
    ports:
      - "8124:8124"
    environment:
      IS_LOCAL: "True"
      <<: *log-level
      <<: *mg-alphas
      GRAPL_DGRAPH_TTL_S: "${GRAPL_DGRAPH_TTL_S:-31536000}"
      GRAPL_TTL_DELETE_BATCH_SIZE: "${GRAPL_TTL_DELETE_BATCH_SIZE:-10}"
    tty: true
    links:
      - grapl-master-graph-db:master_graph
    extra_hosts:
      - amazonaws:127.0.0.1

  #
  # JS/web services
  #

  nginx:
    image: nginxinc/nginx-unprivileged
    command: nginx
    volumes:
      - ./etc/local_grapl/nginx.conf:/etc/nginx/nginx.conf:ro
    ports:
      - "1234:3128"
    depends_on:
      - s3
      - sqs
      - grapl-provision
      - grapl-graphql-endpoint
      - grapl-ux-router
  
  grapl-engagement-view-uploader:
    image: grapl/grapl-engagement-view:${TAG:-latest}
    build: 
      context: src/js/engagement_view
      dockerfile: Dockerfile
      target: engagement-view-local-deploy
    command: |
      /bin/bash -c "
        wait-for-it grapl-provision:8126 --timeout=120 &&
        ./upload_local.sh &&
        python -m http.server 8127  # wait-for-it
      "
    links:
      - s3:minio
    depends_on: 
      - grapl-provision
  
  grapl-graphql-endpoint:
    image: grapl/grapl-graphql-endpoint:${TAG:-latest}
    build: 
      context: src/js/graphql_endpoint
      dockerfile: Dockerfile
      target: graphql-endpoint-deploy
    command: yarn start server
    environment:
      <<: *mg-alphas
      IS_LOCAL: "True"
      PORT: "5000"
      JWT_SECRET_ID: "JWT_SECRET_ID"
    links:
      - grapl-master-graph-db:master_graph
      - secretsmanager:secretsmanager.us-east-1.amazonaws.com
    ports:
      - 5000:5000

    networks:
      default:
        aliases:
          - graphql_endpoint

  grapl-notebook:
    image: grapl/grapl-notebook:${TAG:-latest}
    build: 
      context: src
      dockerfile: ./python/Dockerfile
      target: grapl-notebook
    user: grapl
    environment:
      <<: *mg-alphas
    links:
      - grapl-master-graph-db:master_graph
    ports:
      - 8888:8888

  #
  # Utility services
  #

  grapl-provision:
    image: grapl/grapl-provision:${TAG:-latest}
    build: 
      context: src
      dockerfile: ./python/Dockerfile
      target: grapl-provision
    command: |
      /bin/bash -c "
        export TIMEOUT=35 &&
        # it doesn't seem to like waiting for sqs
        # wait-for-it sqs:9324 &&
        wait-for-it s3:9000 --timeout=$$TIMEOUT &&
        wait-for-it dynamodb:8000 --timeout=$$TIMEOUT &&
        wait-for-it grapl-master-graph-db:8080 --timeout=$$TIMEOUT &&
        wait-for-it secretsmanager:4584 --timeout=$$TIMEOUT &&
        . venv/bin/activate &&
        python /home/grapl/grapl_local_provision/provision_local_identity_table.py &&
        python /home/grapl/grapl_local_provision/grapl_provision.py &&
        # Host a server on this port, so that tests can wait-for-it
        python -m http.server 8126
      "
    environment:
      GRAPL_LOG_LEVEL: "${GRAPL_LOG_LEVEL:-INFO}"
      <<: *mg-alphas
    tty: true
    ports:
      - 8126:8126
    links:
      - grapl-master-graph-db:master_graph
      - s3:minio
      - sqs:sqs.us-east-1.amazonaws.com
      - secretsmanager:secretsmanager.us-east-1.amazonaws.com
      - dynamodb:dynamodb
    extra_hosts:
      - sqs:127.0.0.1
      - amazonaws:127.0.0.1
      - minio:127.0.0.1
    depends_on:
      - dynamodb
      - grapl-master-graph-db
      - s3
      - secretsmanager
      - sqs

networks:
  default:
    name: grapl-network

